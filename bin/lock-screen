#!/bin/bash

readonly WALLPAPER_PATH="${1:-/usr/share/archlinux/wallpaper/archlinux-simplyblack.png}"
readonly BACKGROUND_COLOR="${2:-000000}"

if [[ -f "${WALLPAPER_PATH}" ]]; then
  readonly CONVERTED_WALLPAPER_PATH="/tmp/lock-screen-wallpaper.png"
  readonly RESOLUTION="$(xrandr 2>/dev/null | awk '/*/ {print $1; exit}')"
  if [[ -n "${RESOLUTION}" ]]; then
    convert \
      "${WALLPAPER_PATH}" \
      -background "#${BACKGROUND_COLOR}" \
      -resize "${RESOLUTION}" \
      -gravity center \
      -extent "${RESOLUTION}" \
      PNG:"${CONVERTED_WALLPAPER_PATH}" \
      && readonly IMAGE_OPTION="--image="${CONVERTED_WALLPAPER_PATH}""
  fi
fi

i3lock \
  --nofork \
  --show-failed-attempts \
  --pointer=default \
  --color="${BACKGROUND_COLOR}" \
  "${IMAGE_OPTION:-}"

#!/bin/bash

readonly WALLPAPER_PATH="${1:-/usr/share/backgrounds/archlinux/archlinux-simplyblack.png}"
readonly BACKGROUND_COLOR="${2:-000000}"

RESOLUTION="$(xrandr 2>/dev/null | awk '/*/ {print $1; exit}')"
readonly RESOLUTION

{
	convert \
		"${WALLPAPER_PATH}" \
		-background "#${BACKGROUND_COLOR}" \
		-resize "${RESOLUTION}" \
		-gravity center \
		-extent "${RESOLUTION}" \
		RGB:- \
	| i3lock \
		--nofork \
		--show-failed-attempts \
		--pointer=default \
		--color="${BACKGROUND_COLOR}" \
		--raw="${RESOLUTION}:rgb" \
		--image=/dev/stdin
} 2>/dev/null
